<html>
  <head>
    <link
      href="https://fonts.googleapis.com/css?family=Roboto"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Roboto";
        font-size: 12px;
      }
      table {
        border: 1px solid #ccc;
        border-collapse: collapse;
        width: max-content;
        background-color: #fff;
      }
      td {
        border: 1px solid #e7e7e9;
      }
      .condition,
      .action {
        display: flex;
        flex-direction: row;
        align-items: center;
      }
      thead {
        position: sticky;
      }
      thead,
      thead .condition input {
        background-color: #f7f7f9;
      }

      .action,
      thead .action input {
        background-color: lch(86.09% 21.54 291.97);
      }
      input {
        border: none;
        outline: none;
        padding: 5px;
        padding-left: 10px;
      }

      .panel {
        margin-top: 10px;
        max-width: 100vw;
        width: 100vw;
        max-height: 60vh;
        overflow: scroll;
        width: 100vw; /* full viewport width */
        max-width: 100%;
        overflow-x: auto; /* scroll only when needed */
        overflow-y: auto;
        background-color: #c2c2c2;
        padding: 10px;
      }
      .toolbar {
        display: flex;
        flex-direction: row;
        gap: 10px;
      }
      .material-symbols-outlined {
        color: hsla(0, 0%, 0%, 0.447);
      }
      .material-symbols-outlined:hover {
        color: hsla(0, 0%, 0%, 0.8);
      }
      .invalid {
  background-color: #ffe6e6;
  border: 2px solid #ff4d4f;
}
.invalid input{
      background-color: #ffe6e6;
}
    </style>
  </head>
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=close_small"
  />
  <body>
    <div id="app">
      <div class="toolbar">
        <button @click="addCondition">Add Condition</button>
        <button @click="addAction">Add Action</button>
        <button @click="addRow">Add Row</button>
        <button>Validate</button>
        <button>Generate Rule JSON</button>
      </div>

      <div class="panel">
        <div class="inner-panel">
          <table>
            <thead>
              <tr>
                <td></td>
                <td></td>
                <td v-for="(c ,i) in headers" :key="'h-' + i">
                  <div class="condition">
                    <input type="text" v-model="headers[i]" />
                    <button
                      style="
                        border: none;
                        background-color: hsla(0, 0%, 100%, 0);
                        cursor: pointer;
                      "
                      @click="removeCondition(i)"
                    >
                      <span class="material-symbols-outlined">
                        close_small
                      </span>
                    </button>
                  </div>
                </td>
                <td v-for="(a,i) in actions" :key="'a-' + i">
                  <div class="action">
                    <div style="padding-left: 5px">@</div>
                    <input
                      style="padding-left: 0px"
                      type="text"
                      v-model="actions[i]"
                    />
                    <button
                      style="
                        border: none;
                        background-color: hsla(0, 0%, 100%, 0);
                        cursor: pointer;
                      "
                      @click="removeAction(i)"
                    >
                      <span class="material-symbols-outlined">
                        close_small
                      </span>
                    </button>
                  </div>
                </td>
              </tr>
            </thead>
            <tbody>
              <tr v-for="v,index in rows">
                <td><div style="padding: 10px">{{index+1}}</div></td>
                <td>
                  <button
                    style="
                      border: none;
                      background-color: #fff;
                      cursor: pointer;
                    "
                    @click="removeRow(index)"
                  >
                    <span class="material-symbols-outlined"> close_small </span>
                  </button>
                </td>
                <td
                  v-for="(c ,i) in v.conditions"
                  :key="'c-' + index + '-' + i"
                  :class="{ invalid: !validateCondition(v.conditions[i]) }"
                >
                  <input
                    type="text"
                    v-model="v.conditions[i]"
                    @input="() => {}"
                    
                  />
                </td>
                <td v-for="(c,i) in v.actions" :key="'a-' + index + '-' + i"
                 :class="{ invalid: !validateAction(v.actions[i]) }">
                  <input
                    type="text"
                    v-model="v.actions[i]"
                    @input="() => {}"
                   
                  />
                </td>
              </tr>
            </tbody>
          </table>
          <div style="min-height: 20px"></div>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
      const { createApp, ref } = Vue;

      createApp({
        setup() {
          const headers = ref(["name", "age"]);
          const actions = ref(["message"]);
          const rows = ref([
            { conditions: ["=~ v*iek", "23"], actions: ["vivek"] },
          ]);
          const addCondition = () => {
            headers.value.push("condition_" + headers.value.length);
            for (var i = 0; i < rows.value.length; i++) {
              rows.value[i].conditions.push("");
            }
          };
          const addAction = () => {
            actions.value.push("action_" + actions.value.length);
            for (var i = 0; i < rows.value.length; i++) {
              rows.value[i].actions.push("");
            }
          };
          const addRow = () => {
            var result = {
              conditions: Array(headers.value.length).fill(" "),
              actions: new Array(actions.value.length).fill(" "),
            };
            rows.value.push(result);
          };
          const removeCondition = (colIndex) => {
            headers.value.splice(colIndex, 1);

            rows.value.forEach((row) => {
              row.conditions.splice(colIndex, 1);
            });
          };
          const removeRow = (rowIndex) => {
            rows.value.splice(rowIndex, 1);
          };
          const removeAction = (colIndex) => {
            actions.value.splice(colIndex, 1);

            rows.value.forEach((row) => {
              row.actions.splice(colIndex, 1);
            });
          };
          //validate
          const validateCondition = (value) => {
            if (!value) return false;
            try {
              return /^[a-zA-Z0-9=~* ]+$/.test(value);
            } catch {
              return false;
            }
          };

          const validateAction = (value) => {
            return value && value.trim().length > 0;
          };

          const validateAll = () => {
            return rows.value.every(
              (row) =>
                row.conditions.every(validateCondition) &&
                row.actions.every(validateAction)
            );
          };
          return {
            headers,
            actions,
            rows,
            addAction,
            addCondition,
            addRow,
            removeRow,
            removeAction,
            removeCondition,
            validateCondition,
            validateAction
          };
        },
      }).mount("#app");
    </script>
  </body>
</html>
